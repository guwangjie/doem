(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-b52334e8"],{"0618":function(t,e,i){"use strict";var s=i("ac83");t.exports=function(){var t=s(this),e="";return t.global&&(e+="g"),t.ignoreCase&&(e+="i"),t.multiline&&(e+="m"),t.dotAll&&(e+="s"),t.unicode&&(e+="u"),t.sticky&&(e+="y"),e}},"21d4":function(t,e,i){"use strict";var s=i("0618"),a=i("dcb6"),r=RegExp.prototype.exec,n=String.prototype.replace,o=r,c=function(){var t=/a/,e=/b*/g;return r.call(t,"a"),r.call(e,"a"),0!==t.lastIndex||0!==e.lastIndex}(),l=a.UNSUPPORTED_Y||a.BROKEN_CARET,d=void 0!==/()??/.exec("")[1],h=c||d||l;h&&(o=function(t){var e,i,a,o,h=this,u=l&&h.sticky,v=s.call(h),_=h.source,g=0,m=t;return u&&(v=v.replace("y",""),-1===v.indexOf("g")&&(v+="g"),m=String(t).slice(h.lastIndex),h.lastIndex>0&&(!h.multiline||h.multiline&&"\n"!==t[h.lastIndex-1])&&(_="(?: "+_+")",m=" "+m,g++),i=new RegExp("^(?:"+_+")",v)),d&&(i=new RegExp("^"+_+"$(?!\\s)",v)),c&&(e=h.lastIndex),a=r.call(u?i:h,m),u?a?(a.input=a.input.slice(g),a[0]=a[0].slice(g),a.index=h.lastIndex,h.lastIndex+=a[0].length):h.lastIndex=0:c&&a&&(h.lastIndex=h.global?a.index+a[0].length:e),d&&a&&a.length>1&&n.call(a[0],i,(function(){for(o=1;o<arguments.length-2;o++)void 0===arguments[o]&&(a[o]=void 0)})),a}),t.exports=o},"2ceb":function(t,e,i){"use strict";var s=i("7cd9"),a=i.n(s);a.a},3303:function(t,e,i){var s=i("f240"),a=i("3193"),r=function(t){return function(e,i){var r,n,o=String(a(e)),c=s(i),l=o.length;return c<0||c>=l?t?"":void 0:(r=o.charCodeAt(c),r<55296||r>56319||c+1===l||(n=o.charCodeAt(c+1))<56320||n>57343?t?o.charAt(c):r:t?o.slice(c,c+2):n-56320+(r-55296<<10)+65536)}};t.exports={codeAt:r(!1),charAt:r(!0)}},"3e5e":function(t,e,i){"use strict";var s=i("deaa"),a=i("e1dd"),r=i("ac83"),n=i("3193"),o=i("fb8e"),c=i("536c"),l=i("684e"),d=i("81a0"),h=i("21d4"),u=i("f30e"),v=[].push,_=Math.min,g=4294967295,m=!u((function(){return!RegExp(g,"y")}));s("split",2,(function(t,e,i){var s;return s="c"=="abbc".split(/(b)*/)[1]||4!="test".split(/(?:)/,-1).length||2!="ab".split(/(?:ab)*/).length||4!=".".split(/(.?)(.?)/).length||".".split(/()()/).length>1||"".split(/.?/).length?function(t,i){var s=String(n(this)),r=void 0===i?g:i>>>0;if(0===r)return[];if(void 0===t)return[s];if(!a(t))return e.call(s,t,r);var o,c,l,d=[],u=(t.ignoreCase?"i":"")+(t.multiline?"m":"")+(t.unicode?"u":"")+(t.sticky?"y":""),_=0,m=new RegExp(t.source,u+"g");while(o=h.call(m,s)){if(c=m.lastIndex,c>_&&(d.push(s.slice(_,o.index)),o.length>1&&o.index<s.length&&v.apply(d,o.slice(1)),l=o[0].length,_=c,d.length>=r))break;m.lastIndex===o.index&&m.lastIndex++}return _===s.length?!l&&m.test("")||d.push(""):d.push(s.slice(_)),d.length>r?d.slice(0,r):d}:"0".split(void 0,0).length?function(t,i){return void 0===t&&0===i?[]:e.call(this,t,i)}:e,[function(e,i){var a=n(this),r=void 0==e?void 0:e[t];return void 0!==r?r.call(e,a,i):s.call(String(a),e,i)},function(t,a){var n=i(s,t,this,a,s!==e);if(n.done)return n.value;var h=r(t),u=String(this),v=o(h,RegExp),f=h.unicode,p=(h.ignoreCase?"i":"")+(h.multiline?"m":"")+(h.unicode?"u":"")+(m?"y":"g"),C=new v(m?h:"^(?:"+h.source+")",p),x=void 0===a?g:a>>>0;if(0===x)return[];if(0===u.length)return null===d(C,u)?[u]:[];var b=0,y=0,k=[];while(y<u.length){C.lastIndex=m?y:0;var w,E=d(C,m?u:u.slice(y));if(null===E||(w=_(l(C.lastIndex+(m?0:y)),u.length))===b)y=c(u,y,f);else{if(k.push(u.slice(b,y)),k.length===x)return k;for(var T=1;T<=E.length-1;T++)if(k.push(E[T]),k.length===x)return k;y=b=w}}return k.push(u.slice(b)),k}]}),!m)},"4a58":function(t,e,i){"use strict";var s=i("91fe"),a=i("a8c9"),r=[].reverse,n=[1,2];s({target:"Array",proto:!0,forced:String(n)===String(n.reverse())},{reverse:function(){return a(this)&&(this.length=this.length),r.call(this)}})},"536c":function(t,e,i){"use strict";var s=i("3303").charAt;t.exports=function(t,e,i){return e+(i?s(t,e).length:1)}},"7cd9":function(t,e,i){},"81a0":function(t,e,i){var s=i("67ea"),a=i("21d4");t.exports=function(t,e){var i=t.exec;if("function"===typeof i){var r=i.call(t,e);if("object"!==typeof r)throw TypeError("RegExp exec method returned something other than an Object or null");return r}if("RegExp"!==s(t))throw TypeError("RegExp#exec called on incompatible receiver");return a.call(t,e)}},b3f9:function(t,e,i){"use strict";var s=i("91fe"),a=i("21d4");s({target:"RegExp",proto:!0,forced:/./.exec!==a},{exec:a})},d780:function(t,e,i){"use strict";var s=i("deaa"),a=i("ac83"),r=i("ee6f"),n=i("684e"),o=i("f240"),c=i("3193"),l=i("536c"),d=i("81a0"),h=Math.max,u=Math.min,v=Math.floor,_=/\$([$&'`]|\d\d?|<[^>]*>)/g,g=/\$([$&'`]|\d\d?)/g,m=function(t){return void 0===t?t:String(t)};s("replace",2,(function(t,e,i,s){var f=s.REGEXP_REPLACE_SUBSTITUTES_UNDEFINED_CAPTURE,p=s.REPLACE_KEEPS_$0,C=f?"$":"$0";return[function(i,s){var a=c(this),r=void 0==i?void 0:i[t];return void 0!==r?r.call(i,a,s):e.call(String(a),i,s)},function(t,s){if(!f&&p||"string"===typeof s&&-1===s.indexOf(C)){var r=i(e,t,this,s);if(r.done)return r.value}var c=a(t),v=String(this),_="function"===typeof s;_||(s=String(s));var g=c.global;if(g){var b=c.unicode;c.lastIndex=0}var y=[];while(1){var k=d(c,v);if(null===k)break;if(y.push(k),!g)break;var w=String(k[0]);""===w&&(c.lastIndex=l(v,n(c.lastIndex),b))}for(var E="",T=0,S=0;S<y.length;S++){k=y[S];for(var R=String(k[0]),j=h(u(o(k.index),v.length),0),D=[],I=1;I<k.length;I++)D.push(m(k[I]));var V=k.groups;if(_){var $=[R].concat(D,j,v);void 0!==V&&$.push(V);var O=String(s.apply(void 0,$))}else O=x(R,v,j,D,V,s);j>=T&&(E+=v.slice(T,j)+O,T=j+R.length)}return E+v.slice(T)}];function x(t,i,s,a,n,o){var c=s+t.length,l=a.length,d=g;return void 0!==n&&(n=r(n),d=_),e.call(o,d,(function(e,r){var o;switch(r.charAt(0)){case"$":return"$";case"&":return t;case"`":return i.slice(0,s);case"'":return i.slice(c);case"<":o=n[r.slice(1,-1)];break;default:var d=+r;if(0===d)return e;if(d>l){var h=v(d/10);return 0===h?e:h<=l?void 0===a[h-1]?r.charAt(1):a[h-1]+r.charAt(1):e}o=a[d-1]}return void 0===o?"":o}))}}))},dcb6:function(t,e,i){"use strict";var s=i("f30e");function a(t,e){return RegExp(t,e)}e.UNSUPPORTED_Y=s((function(){var t=a("a","y");return t.lastIndex=2,null!=t.exec("abcd")})),e.BROKEN_CARET=s((function(){var t=a("^r","gy");return t.lastIndex=2,null!=t.exec("str")}))},deaa:function(t,e,i){"use strict";i("b3f9");var s=i("3d8a"),a=i("f30e"),r=i("57c4"),n=i("21d4"),o=i("2ba5"),c=r("species"),l=!a((function(){var t=/./;return t.exec=function(){var t=[];return t.groups={a:"7"},t},"7"!=="".replace(t,"$<a>")})),d=function(){return"$0"==="a".replace(/./,"$0")}(),h=r("replace"),u=function(){return!!/./[h]&&""===/./[h]("a","$0")}(),v=!a((function(){var t=/(?:)/,e=t.exec;t.exec=function(){return e.apply(this,arguments)};var i="ab".split(t);return 2!==i.length||"a"!==i[0]||"b"!==i[1]}));t.exports=function(t,e,i,h){var _=r(t),g=!a((function(){var e={};return e[_]=function(){return 7},7!=""[t](e)})),m=g&&!a((function(){var e=!1,i=/a/;return"split"===t&&(i={},i.constructor={},i.constructor[c]=function(){return i},i.flags="",i[_]=/./[_]),i.exec=function(){return e=!0,null},i[_](""),!e}));if(!g||!m||"replace"===t&&(!l||!d||u)||"split"===t&&!v){var f=/./[_],p=i(_,""[t],(function(t,e,i,s,a){return e.exec===n?g&&!a?{done:!0,value:f.call(e,i,s)}:{done:!0,value:t.call(i,e,s)}:{done:!1}}),{REPLACE_KEEPS_$0:d,REGEXP_REPLACE_SUBSTITUTES_UNDEFINED_CAPTURE:u}),C=p[0],x=p[1];s(String.prototype,t,C),s(RegExp.prototype,_,2==e?function(t,e){return x.call(t,this,e)}:function(t){return x.call(t,this)})}h&&o(RegExp.prototype[_],"sham",!0)}},fa74:function(t,e,i){"use strict";i.r(e);var s=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"app-container service_desktop_index",on:{click:function(e){return t.handleClickCloseDialog(e)}}},[i("el-dialog",{staticClass:"patch_dialog",attrs:{title:"提示",visible:t.patchDialog,width:"30%"},on:{"update:visible":function(e){t.patchDialog=e}}},[i("el-select",{attrs:{placeholder:"请选择"},model:{value:t.patch_service_id,callback:function(e){t.patch_service_id=e},expression:"patch_service_id"}},t._l(t.online_service_list,(function(t){return i("el-option",{key:t.value,attrs:{span:24,label:t.label,value:t.value}})})),1),i("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[i("el-button",{nativeOn:{click:function(e){t.patchDialog=!1}}},[t._v("取 消")]),i("el-button",{attrs:{type:"primary"},nativeOn:{click:function(e){return t.handleClickPatchServiceConfirm()}}},[t._v("确 定")])],1)],1),i("div",{staticClass:"left"},[i("div",{staticClass:"visitor_tab"},[i("div",{staticClass:"item",class:1==t.visitor_tab_index?"active_item":"",on:{click:function(e){return t.handleClickVisitorTabItem(1)}}},[t._v(" 当前 ")]),i("div",{staticClass:"item",class:2==t.visitor_tab_index?"active_item":"",on:{click:function(e){return t.handleClickVisitorTabItem(2)}}},[t._v(" 历史会话 ")])]),i("div",{directives:[{name:"show",rawName:"v-show",value:1==t.visitor_tab_index,expression:"visitor_tab_index == 1"}],staticClass:"visitor_list scrollBar"},t._l(t.visitor_list,(function(e,s){return i("div",{key:s,staticClass:"item",class:["online"==e.visitor_status?"":"offline_item",e.id==t.currentChatVisitor.id?"active_item":""],on:{click:function(e){return t.handleClickshowChatDialog(s)}}},[i("div",{staticClass:"img_box"},[i("img",{staticClass:"img",attrs:{src:e.portrait}}),0!=e.message_count?i("div",{staticClass:"message_count"},[t._v(" "+t._s(e.message_count)+" ")]):t._e()]),i("div",{staticClass:"nickname"},[i("div",{staticClass:"text_hidden"},[t._v(" "+t._s(e.nickname)),i("span",{staticClass:"visit_origin_text"},[t._v(t._s(e.visit_origin_text))])]),i("div",{directives:[{name:"show",rawName:"v-show",value:""!=e.temp_text,expression:"item.temp_text != ''"}],staticClass:"temp_text"},[t._v(" [草稿] ")])])])})),0),i("div",{directives:[{name:"show",rawName:"v-show",value:2==t.visitor_tab_index,expression:"visitor_tab_index == 2"}],staticClass:"history_list scrollBar"},t._l(t.history_list,(function(e,s){return i("div",{key:s,staticClass:"item",class:e.id==t.currentHistoryVisitor.id?"active_item":"",on:{click:function(e){return t.handleClickshowHistoryDialog(s)}}},[i("div",{staticClass:"img_box"},[i("img",{staticClass:"img",attrs:{src:e.portrait}})]),i("div",{staticClass:"nickname"},[i("div",{staticClass:"text_hidden"},[t._v(t._s(e.nickname))])])])})),0)]),i("div",{staticClass:"middle"},[Object.keys(t.currentChatVisitor).length>0&&1==t.visitor_tab_index?i("div",{staticClass:"chat_dialog"},[i("div",{staticClass:"chat_header"},[i("div",{staticClass:"chat_header_left"},[i("div",{staticClass:"img_box"},[i("img",{staticClass:"img",attrs:{src:t.currentChatVisitor.portrait}})]),i("div",{staticClass:"nickname"},[t._v(" "+t._s(t.currentChatVisitor.nickname)+" ")])]),i("div",{staticClass:"chat_header_right"},[i("div",{staticClass:"patch_box",on:{click:function(e){return t.handleClickPatchChat()}}},[t._v("转接")]),i("div",{staticClass:"close_box",on:{click:function(e){return t.handleClickCloseChat()}}},[i("svg-icon",{staticClass:"icon",attrs:{iconClass:"close"}}),i("div",{staticClass:"close_btn"},[t._v("结束会话")])],1)])]),i("div",{ref:"scroll_chat",staticClass:"scroll_chat scrollBar"},t._l(t.currentChatVisitor.message,(function(e,s){return i("div",{key:s,staticClass:"scroll_chat_row"},[e.show_time?i("div",{staticClass:"time_row"},[i("div",{staticClass:"time_row_text"},[t._v(" "+t._s(t.transformToDate(e.time))+" ")])]):t._e(),"visitor"==e.identity?i("div",{staticClass:"scroll_chat_left"},[i("div",{staticClass:"img_box"},[i("img",{staticClass:"img",attrs:{src:t.currentChatVisitor.portrait}})]),"text"==e.type?i("div",{staticClass:"content",domProps:{innerHTML:t._s(e.content)}}):t._e(),"image"==e.type?i("el-image",{staticClass:"chat_img",attrs:{src:e.content,"preview-src-list":[e.content]}}):t._e()],1):i("div",{staticClass:"scroll_chat_right"},["text"==e.type?i("div",{staticClass:"content",domProps:{innerHTML:t._s(e.content)}}):t._e(),"image"==e.type?i("el-image",{staticClass:"chat_img",attrs:{src:e.content,"preview-src-list":[e.content]}}):t._e(),i("div",{staticClass:"img_box"},[i("img",{staticClass:"img",attrs:{src:t.avatar}})])],1)])})),0),i("div",{staticClass:"send_box"},[i("div",{staticClass:"tool_bar"},[i("div",{directives:[{name:"show",rawName:"v-show",value:t.show_emoji,expression:"show_emoji"}],staticClass:"emoji_list"},t._l(t.emojis,(function(e,s){return i("div",{key:s,staticClass:"emoji_item"},[i("img",{staticClass:"img",attrs:{src:e.img},on:{click:function(i){return t.handleInsertEmoji(e.name)}}})])})),0),i("div",{staticClass:"emoji",on:{click:function(e){return t.handleShowEmoji()}}},[i("svg-icon",{staticClass:"icon",attrs:{iconClass:"emoji"}})],1),i("div",{staticClass:"picture",on:{click:function(e){return t.handleOpenImageUploadDialog()}}},[i("svg-icon",{staticClass:"icon",attrs:{iconClass:"picture"}})],1)]),i("div",{staticClass:"send_textarea"},[i("div",{ref:"editor",staticClass:"scrollBar textarea",attrs:{contenteditable:"true"},on:{keydown:function(e){return t.handleKeyDown(e)},keyup:function(e){return t.handlekeyUp(e)},click:function(e){return t.handleEditorClick()}}})]),i("div",{staticClass:"send_btn_box"},[i("div",{staticClass:"tips"},[t._v("ENTER换行 SHIFT+ENTER发送")]),i("el-button",{staticClass:"send_btn",attrs:{type:"primary"},nativeOn:{click:function(e){return t.handleSubmit()}}},[t._v("确定")])],1)])]):t._e(),Object.keys(t.currentHistoryVisitor).length>0&&2==t.visitor_tab_index?i("div",{staticClass:"history_dialog"},[i("div",{staticClass:"history_header"},[i("div",{staticClass:"history_header_left"},[i("div",{staticClass:"img_box"},[i("img",{staticClass:"img",attrs:{src:t.currentHistoryVisitor.portrait}})]),i("div",{staticClass:"nickname"},[t._v(" "+t._s(t.currentHistoryVisitor.nickname)+" ")])])]),i("div",{ref:"scroll_history",staticClass:"scroll_history scrollBar"},t._l(t.currentHistoryVisitor.message,(function(e,s){return i("div",{key:s,staticClass:"scroll_history_row"},[i("div",{staticClass:"time_row"},[i("div",{staticClass:"time_row_text"},[t._v(" "+t._s(e.create_time)+" ")])]),"visitor"==e.identity?i("div",{staticClass:"scroll_history_left"},[i("div",{staticClass:"img_box"},[i("img",{staticClass:"img",attrs:{src:t.currentHistoryVisitor.portrait}})]),"text"==e.type?i("div",{staticClass:"content",domProps:{innerHTML:t._s(e.record_content)}}):t._e(),"image"==e.type?i("el-image",{staticClass:"chat_img",attrs:{src:e.record_content,"preview-src-list":[e.record_content]}}):t._e()],1):i("div",{staticClass:"scroll_history_right"},["text"==e.type?i("div",{staticClass:"content",domProps:{innerHTML:t._s(e.record_content)}}):t._e(),"image"==e.type?i("el-image",{staticClass:"chat_img",attrs:{src:e.record_content,"preview-src-list":[e.record_content]}}):t._e(),i("div",{staticClass:"img_box"},[i("img",{staticClass:"img",attrs:{src:t.avatar}})])],1)])})),0)]):t._e()]),i("div",{directives:[{name:"show",rawName:"v-show",value:1==t.visitor_tab_index,expression:"visitor_tab_index == 1"}],staticClass:"right"},[i("div",{staticClass:"used_tab"},[i("div",{staticClass:"item",class:1==t.used_tab_index?"active":"",on:{click:function(e){return t.handleClickChangeUseTab(1)}}},[t._v(" 客户基本资料 ")]),i("div",{staticClass:"item",class:2==t.used_tab_index?"active":"",on:{click:function(e){return t.handleClickChangeUseTab(2)}}},[t._v(" 快捷回复 ")]),i("div",{staticClass:"item",class:3==t.used_tab_index?"active":"",on:{click:function(e){return t.handleClickChangeUseTab(3)}}},[t._v(" 常用工具 ")])])])],1)},a=[],r=(i("4a58"),i("c1b0"),i("d780"),i("3e5e"),i("94ec"),i("c451")),n={data(){return{}},methods:{transformToDate(t){var e=t.getHours();e=e<10?"0"+e:e;var i=t.getMinutes(),s=t.getSeconds();return i=i<10?"0"+i:i,s=s<10?"0"+s:s,e+":"+i+":"+s},replacepos(t,e,i,s){var a=t.substring(0,e)+s+t.substring(i);return a}}},o=i("b775");function c(t){return Object(o["a"])({url:"/service_manage/serviceDesktopIndexBindClientId",method:"post",data:t})}function l(t){return Object(o["a"])({url:"/service_manage/serviceDesktopIndexGetVisitorInfo",method:"post",data:t})}function d(t){return Object(o["a"])({url:"/service_manage/serviceDesktopIndexAddServiceRecord",method:"post",data:t})}function h(t){return Object(o["a"])({url:"/service_manage/serviceDesktopIndexCloseChat",method:"post",data:t})}function u(){return Object(o["a"])({url:"/emoji/getEmoji",method:"get"})}function v(t){return Object(o["a"])({url:"/upload/uploadImage",method:"post",data:t,headers:{"Content-Type":"multipart/form-data"}})}function _(){return Object(o["a"])({url:"/service_manage/serviceDesktopIndexGetRecordForWeek",method:"get"})}function g(){return Object(o["a"])({url:"/service_manage/serviceDesktopIndexGetOnlineServiceList",method:"get"})}function m(t){return Object(o["a"])({url:"/service_manage/serviceDesktopIndexPatchToVisitor",method:"post",data:t})}var f=i("8876"),{clipboard:p,ipcRenderer:C}=i("34bb"),x=i("9b0f"),b={name:"service_desktop_index",data(){return{List:[],ws:null,visitor_tab_index:1,visitor_list:[],currentChatVisitor:{},show_emoji:!1,emojis:[],lastEditRange:null,patchDialog:!1,online_service_list:[],patch_service_id:null,history_list:[],currentHistoryVisitor:{},used_tab_index:1}},mixins:[n],computed:Object(r["a"])({},Object(f["b"])(["user_id","avatar","nickname"])),mounted(){this.initWebSocket()},methods:{handleClickCloseDialog:function(t){this.show_emoji&&"emoji_list"!=t.target.className&&"emoji_item"!=t.target.className&&"emoji"!=t.target.className&&"emoji"!=t.target.parentNode.className&&(this.show_emoji=!1)},initWebSocket:function(){var t,e,i,s,a,r,n,o=this,h=!1;this.ws=new WebSocket(this.$config.webSocket_Base_Url),this.ws.onopen=function(t){o.$message({message:"客服系统连接成功",type:"success"})},this.ws.onmessage=u=>{if("string"==typeof u.data)try{JSON.parse(u.data),h=!0}catch(_){h=!1}if(!h)return!1;var v=JSON.parse(u.data);switch(v.type){case"bind":c({client_id:v.client_id}).then(t=>{});break;case"wait":s=!1,t=[],o.visitor_list.forEach((e,i)=>{e.id==v.user_id&&(o.$set(o.visitor_list[i],"visitor_status","online"),t=o.visitor_list[i],o.visitor_list.splice(i,1),s=!0)}),s&&o.visitor_list.unshift(t),s||l({user_id:v.user_id}).then(t=>{switch(v.visit_origin){case"1":t.data.visit_origin_text="小程序";break;default:break}t.data.visit_origin=v.visit_origin,t.data.visitor_status="online",t.data.message_count=0,t.data.message=[],t.data.temp_text="",o.visitor_list.unshift(t.data)}),new Notification("提示",{body:"您有一个有新的会话"});break;case"visitor_offline":e=[],o.visitor_list.forEach((t,i)=>{t.id==v.user_id&&(o.$set(o.visitor_list[i],"visitor_status","offline"),e=o.visitor_list[i],o.visitor_list.splice(i,1))}),o.visitor_list=o.visitor_list.concat(e);break;case"text":t=[],i={},o.visitor_list.forEach((e,c)=>{e.id==v.user_id&&(0!=Object.keys(o.currentChatVisitor).length&&o.currentChatVisitor.id==v.user_id||o.$set(o.visitor_list[c],"message_count",e.message_count+1),a=new Date,n=a.getTime(),r=!1,(0==e.message.length||n-e.message[e.message.length-1].time.getTime()>6e3)&&(r=!0),i={type:"text",content:v.content.replace(/(\[\/em)([0-9]{2})(\])/g,'<img src="http://lyqq.cn-lianyi.com/public/static/images/emojis/$2.gif?'+Math.floor(100*Math.random()+1)+'" />'),time:new Date,identity:"visitor",show_time:r},o.visitor_list[c].message.push(i),t=o.visitor_list[c],o.visitor_list.splice(c,1),s=!0)}),s&&o.visitor_list.unshift(t),o.chatDialogScrollToBottom(),d({visitor_id:v.user_id,identity:"visitor",type:"text",time:i.time.getTime(),record_content:v.content}).then(()=>{});break;case"image":t=[],i={},o.visitor_list.forEach((e,c)=>{e.id==v.user_id&&(0!=Object.keys(o.currentChatVisitor).length&&o.currentChatVisitor.id==v.user_id||o.$set(o.visitor_list[c],"message_count",e.message_count+1),a=new Date,n=a.getTime(),r=!1,(0==e.message.length||n-e.message[e.message.length-1].time.getTime()>6e3)&&(r=!0),i={type:"image",content:v.content,time:new Date,identity:"visitor",show_time:r},o.visitor_list[c].message.push(i),t=o.visitor_list[c],o.visitor_list.splice(c,1),s=!0)}),s&&o.visitor_list.unshift(t),o.chatDialogScrollToBottom(),d({visitor_id:v.user_id,identity:"visitor",type:"image",time:i.time.getTime(),record_content:i.content}).then(()=>{});break;default:break}},this.ws.onclose=t=>{}},handleClickVisitorTabItem:function(t){this.visitor_tab_index=t,2==t&&_({}).then(t=>{t.data.forEach((e,i)=>{e.message.forEach((e,s)=>{t.data[i].message[s].record_content=e.record_content.replace(/(\[\/em)([0-9]{2})(\])/g,'<img src="http://lyqq.cn-lianyi.com/public/static/images/emojis/$2.gif?'+Math.floor(100*Math.random()+1)+'" />')})}),this.history_list=t.data,this.history_list.length>0&&(this.currentHistoryVisitor=this.history_list[0])})},handleClickshowChatDialog:function(t){this.visitor_list.forEach((t,e)=>{t.id==this.currentChatVisitor.id&&this.$set(this.visitor_list[e],"temp_text",this.$refs.editor.innerHTML)}),this.visitor_list[t].message_count=0,this.currentChatVisitor=this.visitor_list[t],"undefined"!==typeof this.$refs.editor&&(this.$refs.editor.innerHTML=this.currentChatVisitor.temp_text),this.$set(this.visitor_list[t],"temp_text",""),this.currentChatVisitor.temp_text="",this.chatDialogScrollToBottom()},chatDialogScrollToBottom:function(){Object.keys(this.currentChatVisitor).length>0&&this.$nextTick(()=>{this.$refs.scroll_chat.scrollTop=this.$refs.scroll_chat.scrollHeight})},handleKeyDown:function(t){var e=getSelection();if(this.lastEditRange=e.getRangeAt(0),13==t.keyCode&&t.shiftKey,t.shiftKey&&13==t.keyCode)return this.handleSubmit(),t.preventDefault(),!1;t.ctrlKey&&86==t.keyCode&&p.writeText(p.readText())},handlekeyUp:function(t){var e=getSelection();this.lastEditRange=e.getRangeAt(0)},handleEditorClick:function(t){var e=getSelection();this.lastEditRange=e.getRangeAt(0)},handleShowEmoji:function(){0==this.emojis.length&&u({}).then(t=>{t.data.forEach((e,i)=>{t.data[i].img=e.img.replace(".gif",".gif?"+Math.floor(100*Math.random()+1))}),this.emojis=t.data}),this.show_emoji=!this.show_emoji},handleInsertEmoji:function(t){var e=this.$refs.editor;e.focus();var i=getSelection();this.lastEditRange&&(i.removeAllRanges(),i.addRange(this.lastEditRange));var s=i.getRangeAt(0);if(s.collapsed)if("#text"!=i.anchorNode.nodeName){var a=document.createTextNode(t);if(e.childNodes.length>0&&""!=e.innerText.trim())for(var r=0;r<e.childNodes.length;r++)e.childNodes[r]==i.anchorNode&&(e.childNodes[r].innerHTML="",e.childNodes[r].appendChild(a));else e.innerHTML="",e.appendChild(a);s.selectNodeContents(a),s.setStart(a,t.length),s.collapse(!0),i.removeAllRanges(),i.addRange(s)}else{var n=s.startContainer,o=s.startOffset;n.insertData(o,t),s.setStart(n,o+t.length),s.collapse(!0),i.removeAllRanges(),i.addRange(s)}else{s.startContainer,s.startOffset;document.execCommand("insertText","false",t)}this.lastEditRange=i.getRangeAt(0),this.show_emoji=!1},handleSubmit:function(){var t,e,i,s=this,a=[],r=!1,n={};s.visitor_list.forEach((o,c)=>{o.id==s.currentChatVisitor.id&&"online"==o.visitor_status&&(t=new Date,e=t.getTime(),i=!1,(0==o.message.length||e-o.message[o.message.length-1].time.getTime()>6e3)&&(i=!0),n={type:"text",content:s.$refs.editor.innerHTML.replace(/(\[\/em)([0-9]{2})(\])/g,'<img src="http://lyqq.cn-lianyi.com/public/static/images/emojis/$2.gif?'+Math.floor(100*Math.random()+1)+'" />'),time:new Date,identity:"service",show_time:i},s.visitor_list[c].message.push(n),a=s.visitor_list[c],s.visitor_list.splice(c,1),r=!0)}),r&&(s.visitor_list.unshift(a),s.chatDialogScrollToBottom(),s.ws.send(JSON.stringify({identity:"service",type:"text",visitor_id:s.currentChatVisitor.id,content:s.$refs.editor.innerHTML,nickname:s.nickname,avatar:s.avatar})),d({visitor_id:s.currentChatVisitor.id,identity:"service",type:"text",time:n.time.getTime(),record_content:s.$refs.editor.innerHTML}).then(()=>{}),s.currentChatVisitor.temp_text="",s.$refs.editor.innerHTML="")},handleOpenImageUploadDialog:function(){var t=this;C.send("open-directory-dialog",{properties:["openFile","multiSelections"],filters:[{name:"Images",extensions:["jpg","png","gif"]}]}),C.once("selectedItem",(e,i)=>{i.filePaths.forEach((e,i)=>{x.readFile(e,(i,s)=>{if(i);else{var a=new File([s],e.split("/").reverse()[0],{type:"image/"+e.split(".").reverse()[0]}),r=new FormData;r.append("image",a),t.handleUploadChatImage(r)}})})})},handleUploadChatImage:function(t){v(t).then(t=>{var e,i,s,a=t.data,r=this,n=[],o=!1,c={};r.visitor_list.forEach((t,l)=>{t.id==r.currentChatVisitor.id&&"online"==t.visitor_status&&(e=new Date,i=e.getTime(),s=!1,(0==t.message.length||i-t.message[t.message.length-1].time.getTime()>6e3)&&(s=!0),c={type:"image",content:a,time:new Date,identity:"service",show_time:s},r.visitor_list[l].message.push(c),n=r.visitor_list[l],r.visitor_list.splice(l,1),o=!0)}),o&&(r.visitor_list.unshift(n),r.chatDialogScrollToBottom(),r.ws.send(JSON.stringify({identity:"service",type:"image",visitor_id:r.currentChatVisitor.id,content:a,nickname:r.nickname,avatar:r.avatar})),d({visitor_id:r.currentChatVisitor.id,identity:"service",type:"image",time:c.time.getTime(),record_content:a}).then(()=>{}))})},handleClickCloseChat:function(){h({visitor_id:this.currentChatVisitor.id}).then(()=>{})},handleClickPatchChat:function(){g().then(t=>{0==t.data.length?this.$message({message:"当前没有客服在线",type:"error"}):(this.online_service_list=t.data,this.patchDialog=!0)})},handleClickPatchServiceConfirm:function(){m({visitor_id:this.currentChatVisitor.id,patch_service_id:this.patch_service_id,visit_origin:this.currentChatVisitor.visit_origin}).then(t=>{this.visitor_list.forEach((t,e)=>{t.id==this.currentChatVisitor.id&&this.visitor_list.splice(e,1)}),this.currentChatVisitor={},this.$message({message:"转接成功",type:"success"}),this.patchDialog=!1})},handleClickshowHistoryDialog:function(t){this.currentHistoryVisitor=this.history_list[t]},handleClickChangeUseTab:function(t){this.used_tab_index=t}}},y=b,k=(i("2ceb"),i("e90a")),w=Object(k["a"])(y,s,a,!1,null,"75f43c3a",null);e["default"]=w.exports}}]);
//# sourceMappingURL=chunk-b52334e8.1de116fb.js.map